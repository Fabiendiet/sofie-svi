[macro-sofie2014set_var]
exten => s,1,set(CONN1=0)
exten => s,n,set(CONN2=0)
exten => s,n,set(localCPT=0)
exten => s,n,set(SOM_SEX=0)
exten => s,n,set(sofie_LEN_NUMBV_MIN=1)
exten => s,n,set(sofie_LEN_NUMBV_MAX=12)
exten => s,n,set(sofie_LEN_DATA_MIN=1)
exten => s,n,set(sofie_LEN_DATA_MAX=1)
exten => s,n,set(saisie_nbi_local_CPT_MAX=3)
exten => s,n,set(saisie_nbv_local_CPT_MAX=3)
exten => s,n,set(sofie_LEN_NUMBV_MIN=1)
exten => s,n,set(sofie_LEN_NUMBV_MAX=12)
exten => s,n,set(sofie_LEN_DATA_MIN=1)
exten => s,n,set(sofie_LEN_DATA_MAX=3)
exten => s,n,set(sofie_LEN_NBI_MIN=1)
exten => s,n,set(sofie_LEN_NBI_MAX=6)
exten => s,n,set(sofie_LEN_NBV_MIN=1)
exten => s,n,set(sofie_LEN_NBV_MAX=6)
exten => s,n,set(sofie_LEN_NBN_MIN=1)
exten => s,n,set(sofie_LEN_NBN_MAX=6)
exten => s,n,set(sofie_LEN_NB_SUFFRAGE_MIN=1)
exten => s,n,set(sofie_LEN_NB_SUFFRAGE_MAX=6)
exten => s,n,set(sofie_NUMBV=0)
exten => s,n,set(sofie_NBI=0)
exten => s,n,set(sofie_NBV=0)
exten => s,n,set(sofie_NBN=0)
exten => s,n,set(sofie2014SEX=0)
exten => s,n,set(sofie_NBU=0)
exten => s,n,set(sofie_saisie_incidents_local_CPT=0)
exten => s,n,set(sofie2014Incidents_local_CPT1=0)
exten => s,n,set(sofie2014Incidents_local_CPT2=0)
exten => s,n,set(sofie2014Incidents_local_CPT3=0)
exten => s,n,set(sofie2014Incidents_local_CPT4=0)
exten => s,n,set(sofie2014verif_code_incident_type_CPT=0)
exten => s,n,set(sofie_local_CPT=0)
exten => s,n,set(sofie_local_CPT1=0)
exten => s,n,set(sofie_local_CPT2=0)
exten => s,n,set(sofie_local_CPT3=0)
exten => s,n,set(sofie_local_CPT4=0)
exten => s,n,set(sofie_local_CPT_NBV=0)
exten => s,n,set(sofie_local_CPT_SEX=0)
exten => s,n,set(sofie_local_CPT_MAX=3)
exten => s,n,set(sofie_local_CPT1_MAX=3)
exten => s,n,set(sofie_local_CPT2_MAX=3)
exten => s,n,set(sofie_NB_INCIDENT=0)
exten => s,n,set(sofie_NB_INCIDENT_MAX=0)
exten => s,n,set(sofie_NB_INCIDENT_SELECTED=0)
exten => s,n,set(sofie_NB_INCIDENT_SELECTED=0)
exten => s,n,set(sofie_CODE_INCIDENT=0)
exten => s,n,set(sofie_PASSWD_MIN=4)
exten => s,n,set(sofie_PASSWD_MAX=4)
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie_send_notifcation]
exten => s,1,GotoIf($["${ARG1}" = "notif-sms-init-comite"]?s-notif-sms-init-comite,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-init-rep"]?s-notif-sms-init-rep,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-init-agent"]?s-notif-sms-init-agent,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-panne"]?s-notif-sms-panne,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-reparation"]?s-notif-sms-reparation,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-nonreparation"]?s-notif-sms-nonreparation,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-cde-rep"]?s-notif-sms-cde-rep,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-cde-agent"]?s-notif-sms-cde-agent,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-absence"]?s-notif-sms-absence,1:$[${PRIORITY}+1])
exten => s,n,GotoIf($["${ARG1}" = "notif-sms-reprise"]?s-notif-sms-reprise,1:$[${PRIORITY}+1])
exten => s,n,verbose(1|Erreur: Aucun message trouvÃs.)

exten => s-notif-sms-init-comite,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_standard_init\'\ AND NOTIFICATION_SMS\=\'NOTIF_INIT_COMITE\')
exten => s-notif-sms-init-comite,n,goto(s-notif,1)

exten => s-notif-sms-init-rep,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_standard_init\'\ AND NOTIFICATION_SMS\=\'NOTIF_INIT_REP\')
exten => s-notif-sms-init-rep,n,goto(s-notif,1)

exten => s-notif-sms-init-agent,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_standard_init\'\ AND NOTIFICATION_SMS\=\'NOTIF_INIT_AGENT\')
exten => s-notif-sms-init-agent,n,goto(s-notif,1)

exten => s-notif-sms-panne,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_enreg_incident\'\ AND NOTIFICATION_SMS\=\'NOTIF_PANNE\')
exten => s-notif-sms-panne,n,goto(s-notif,1)

exten => s-notif-sms-reparation,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_enreg_incident\'\ AND NOTIFICATION_SMS\=\'NOTIF_REPARATION\')
exten => s-notif-sms-reparation,n,goto(s-notif,1)

exten => s-notif-sms-nonreparation,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_enreg_incident\'\ AND NOTIFICATION_SMS\=\'NOTIF_NONREPARATION\')
exten => s-notif-sms-nonreparation,n,goto(s-notif,1)

exten => s-notif-sms-cde-rep,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_confirmation_cde\'\ AND NOTIFICATION_SMS\=\'NOTIF_CDE_REP\')
exten => s-notif-sms-cde-rep,n,goto(s-notif,1)

exten => s-notif-sms-cde-rep,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_confirmation_cde\'\ AND NOTIFICATION_SMS\=\'NOTIF_CDE_REP\')
exten => s-notif-sms-cde-rep,n,goto(s-notif,1)

exten => s-notif-sms-cde-rep,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_confirmation_cde\'\ AND NOTIFICATION_SMS\=\'NOTIF_CDE_REP\')
exten => s-notif-sms-cde-rep,n,goto(s-notif,1)

exten => s-notif-sms-cde-agent,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_confirmation_cde\'\ AND NOTIFICATION_SMS\=\'NOTIF_CDE_AGENT\')
exten => s-notif-sms-cde-agent,n,goto(s-notif,1)

exten => s-notif-sms-absence,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_signaler_absence\'\ AND NOTIFICATION_SMS\=\'NOTIF_ABSENCE\')
exten => s-notif-sms-absence,n,goto(s-notif,1)

exten => s-notif-sms-reprise,1,set(WHERE=SCRIPT_CONTEXT\=\'sofie_signaler_reprise\'\ AND NOTIFICATION_SMS\=\'NOTIF_REPRISE\')
exten => s-notif-sms-reprise,n,goto(s-notif,1)

exten => s-notif,1,set(sofie_sms_local_CPT=-1)
exten => s-notif,2,Macro(sofie_sql_getsmscontent,t_sms_content,DA\,SMS_CONTENT,${WHERE},T)
exten => s-notif,103,verbose(1|erreur lors de la reconstitution du message.)
exten => s-notif,3(NEXT_SMS),set(sofie_sms_local_CPT=$[${sofie_sms_local_CPT}+1])
exten => s-notif,n,GotoIf($[${MATH(${sofie_sms_local_CPT} <= ${SELECT_NUMBER_OF_RECORD})}=TRUE]?loop:end_loop)
exten => s-notif,5(loop),Macro(sofie_enreg_sendsms,${sofie_SMS_SHORTCODE},${EVAL(${T_DA${sofie_sms_local_CPT}})},${EVAL(${T_SMS_CONTENT${sofie_sms_local_CPT}})},${ARG2},${ARG3})
;exten => s-notif,n(loop),System(lynx -dump "http://${sofie_SMS_IPSERVER}/sms/sendsms.php?SOA=${sofie_SMS_SHORTCODE}&DA=${EVAL(${T_DA${sofie_sms_local_CPT}})}&Osms=1&Modem=${sofie_SMS_NUM_MODEM}&Content=${EVAL(${T_SMS_CONTENT${sofie_sms_local_CPT}})}")
exten => s-notif,6,goto(NEXT_SMS)
exten => s-notif,n(end_loop),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s-notif,n(SYSTEM_ERROR),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])

[macro-sofie_enreg_sendsms]
exten => s,1,Macro(sofie_sql_insert_sendsms,CONN1,${ARG1},${ARG2},${ARG3},${ARG4},${ARG5})
exten => s,102,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101]);playback(${sofie_audio_file_dir}/${sofie_msg_system_error})
exten => s,103,hangup
exten => s,2,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie2014get_data];${ARG1}=NBI,${ARG2}=${succes_msg_saisie_nb_inscrit}
exten => s,1,noop()
exten => s,n,Macro(sofie2014init_local_CPT)
exten => s,3(REPRISE_SAISIE),set(sofie_local_CPT=$[${sofie_local_CPT}+1])
exten => s,4,GotoIf($[${MATH(${sofie_local_CPT}<=${sofie_local_CPT_MAX})}=TRUE]?SAISI_CODE:FIN_TENTATIVE)
exten => s,5(SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/${ARG2},${succes_audio_file_dir}/${succes_msg_erreur_saisie},${sofie_LEN_DATA_MAX},${sofie_LEN_DATA_MIN},6,0,${succes_audio_file_dir}/${succes_msg_aucune_reponse},3)
exten => s,106,goto(FIN_TENTATIVE)
exten => s,206,goto(REPRISE_SAISIE)
exten => s,306,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?GOTO_REPRISE_SAISIE:LECTURE_SAISIE)
exten => s,406,goto(FIN_TENTATIVE)
exten => s,6(LECTURE_SAISIE),set(${ARG1}=${VALEUR_SAISIE_1})
exten => s,n,set(sofie_local_CPT2=$[${sofie_local_CPT2}+1])
exten => s,n,GotoIf($[${MATH(${sofie_local_CPT2}<=${sofie_local_CPT2_MAX})}=TRUE]?NEXT:FIN_APPEL)
exten => s,n(NEXT),SayDigits(${${ARG1}})
exten => s,10,set(sofie_local_CPT1=0)
exten => s,n(CORRIGE_TOUCHE),set(sofie_local_CPT1=$[${sofie_local_CPT1}+1])
exten => s,n,GotoIf($[${MATH(${sofie_local_CPT1}<=${sofie_local_CPT1_MAX})}=TRUE]?VALIDER_SAISI_CODE:FIN_APPEL)
exten => s,13(VALIDER_SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/msg_corrige_saisie,${succes_audio_file_dir}/${succes_msg_touche_correction_invalid},1,1,1,0,,3)
exten => s,114(FIN_TENTATIVE),goto(sofie2014finappel,cptfin,1)
exten => s,214,goto(REPRISE_SAISIE)
exten => s,314,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?$[${PRIORITY}+1]:$[${PRIORITY}+2])
exten => s,315,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,316,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])
exten => s,414,goto(FIN_TENTATIVE)
exten => s,n(FIN_APPEL),goto(sofie2014finappel,s,1)
exten => s,n(FIN_TENTATIVE),goto(sofie2014finappel,cptfin,1)
exten => s,n(GOTO_REPRISE_SAISIE),playback(${succes_audio_file_dir}/${succes_msg_erreur_saisie})
exten => s,n,goto(REPRISE_SAISIE)

[macro-sofie2014get_data2];${ARG1}=NBI,${ARG2}=${succes_msg_saisie_nb_inscrit}
exten => s,1,noop()
exten => s,n,Macro(sofie2014init_local_CPT)
exten => s,3(REPRISE_SAISIE),set(sofie_local_CPT=$[${sofie_local_CPT}+1])
exten => s,4,GotoIf($[${MATH(${sofie_local_CPT}<=${sofie_local_CPT_MAX})}=TRUE]?SAISI_CODE:FIN_TENTATIVE)
exten => s,5(SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/${ARG2},${succes_audio_file_dir}/${succes_msg_erreur_saisie},${ARG3},${ARG4},6,0,${succes_audio_file_dir}/${succes_msg_aucune_reponse},3)
exten => s,106,goto(FIN_TENTATIVE)
exten => s,206,goto(REPRISE_SAISIE)
exten => s,306,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?GOTO_REPRISE_SAISIE:LECTURE_SAISIE)
exten => s,406,goto(FIN_TENTATIVE)
exten => s,6(LECTURE_SAISIE),set(${ARG1}=${VALEUR_SAISIE_1})
exten => s,n,set(sofie_local_CPT2=$[${sofie_local_CPT2}+1])
exten => s,n,GotoIf($[${MATH(${sofie_local_CPT2}<=${sofie_local_CPT2_MAX})}=TRUE]?NEXT:FIN_APPEL)
exten => s,n(NEXT),SayDigits(${${ARG1}})
exten => s,10,set(sofie_local_CPT1=0)
exten => s,n(CORRIGE_TOUCHE),set(sofie_local_CPT1=$[${sofie_local_CPT1}+1])
exten => s,n,GotoIf($[${MATH(${sofie_local_CPT1}<=${sofie_local_CPT1_MAX})}=TRUE]?VALIDER_SAISI_CODE:FIN_APPEL)
exten => s,13(VALIDER_SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/msg_corrige_saisie,${succes_audio_file_dir}/${succes_msg_touche_correction_invalid},1,1,1,0,,3)
exten => s,114(FIN_TENTATIVE),goto(sofie2014finappel,cptfin,1)
exten => s,214,goto(REPRISE_SAISIE)
exten => s,314,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?$[${PRIORITY}+1]:$[${PRIORITY}+2])
exten => s,315,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,316,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])
exten => s,414,goto(FIN_TENTATIVE)
exten => s,n(FIN_APPEL),goto(sofie2014finappel,s,1)
exten => s,n(FIN_TENTATIVE),goto(sofie2014finappel,cptfin,1)
exten => s,n(GOTO_REPRISE_SAISIE),playback(${succes_audio_file_dir}/${succes_msg_erreur_saisie})
exten => s,n,goto(REPRISE_SAISIE)

[macro-sofie2014get_data_list];ARG1=CODEPARTI,ARG2=${NB_LISTE}
exten => s,1,set(DATA_INDEX=-1)
exten => s,2,set(DATA_LISTE0=0)
exten => s,3(LISTE_SUIVANT),Macro(sofie2014init_local_CPT)
exten => s,4,set(DATA_INDEX=$[${DATA_INDEX}+1])
exten => s,n,GotoIf($[${MATH(${DATA_INDEX}<=${ARG2})}=TRUE]?$[${PRIORITY}+1]:FIN_LIST)
exten => s,n(REPRISE_SAISIE),set(sofie_local_CPT=$[${sofie_local_CPT}+1])
exten => s,7,GotoIf($[${MATH(${sofie_local_CPT}<=${sofie_local_CPT_MAX})}=TRUE]?SAISI_CODE:FIN_APPEL)
;exten =>s,8(SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/msg_saisie_suffrage_exprime_liste_${DATA_INDEX},${succes_audio_file_dir}/${succes_msg_erreur_saisie},${sofie_LEN_NB_SUFFRAGE_MAX},${sofie_LEN_NB_SUFFRAGE_MIN},30,0,,3)
exten =>s,8(SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/msg_sofie_saisie_data_list_${${ARG1}${DATA_INDEX}},${succes_audio_file_dir}/${succes_msg_erreur_saisie},${sofie_LEN_NB_SUFFRAGE_MAX},${sofie_LEN_NB_SUFFRAGE_MIN},6,0,${succes_audio_file_dir}/${succes_msg_aucune_reponse},3)
exten => s,109,goto(sofie2014finappel,cptfin,1)
exten => s,209,goto(REPRISE_SAISIE)
exten => s,309,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?GOTO_REPRISE_SAISIE:FIN_LIST)
exten => s,409,goto(FIN_TENTATIVE)
exten => s,9(LECTURE_SAISIE),set(${${ARG1}${DATA_INDEX}}=${VALEUR_SAISIE_1})
exten => s,10,SayDigits(${${${ARG1}${DATA_INDEX}}})
exten => s,n(CORRIGE_TOUCHE),set(sofie_local_CPT1=$[${sofie_local_CPT1}+1])
exten => s,n,GotoIf($[${MATH(${sofie_local_CPT1}<=${sofie_local_CPT1_MAX})}=TRUE]?VALIDER_SAISI_CODE:FIN_APPEL)
exten => s,13(VALIDER_SAISI_CODE),Macro(svi_saisie_ctl3,,${succes_audio_file_dir}/${succes_msg_corrige_saisie},${succes_audio_file_dir}/${succes_msg_touche_correction_invalid},1,1,1,0,,3)
;exten => s,13(VALIDER_SAISI_CODE),Macro(svi_menu_v2,,${succes_audio_file_dir}/${succes_msg_corrige_saisie},${succes_audio_file_dir}/${succes_msg_touche_correction_invalid},1,3,1,3,${succes_audio_file_dir}/${succes_msg_aucune_reponse},#,${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,114,goto(sofie2014finappel,cptfin,1)
;exten => s,114,playback(${succes_audio_file_dir}/${succes_msg_erreur_touche})
;exten => s,115,goto(s,CORRIGE_TOUCHE)
exten => s,214,goto(REPRISE_SAISIE)
exten => s,314,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?s,20:$[${PRIORITY}+1])
exten => s,315,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+201])
exten => s,414,goto(FIN_TENTATIVE)
exten => s,14,playback(${succes_audio_file_dir}/${succes_msg_erreur_touche})
exten => s,15,goto(CORRIGE_TOUCHE)
exten => s,16(FIN_LIST),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,17,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])
exten => s,n(GOTO_REPRISE_SAISIE),playback(${succes_audio_file_dir}/${succes_msg_erreur_saisie})
exten => s,n,goto(REPRISE_SAISIE)
exten => s,n,goto(LISTE_SUIVANT)
exten => s,n(FIN_TENTATIVE),goto(sofie2014finappel,cptfin,1)

[macro-sofie2014svi_test_date_validity];${ARG1}:nom de la procedure stockÃ©,
;exten => s,1,Macro(sofie2014replace,\@_VALIDITY1\,@_VALIDITY2,\\\ ,\\\,,new_str)
;exten => s,n,noop(${new_str})
;exten => s,n,hangup
exten => s,1,set(sofie2014test_DATE_DONNEE=)
exten => s,n,gotoif($["${LEN(${ARG2})}" = "4"]?$[${PRIORITY}+1]:$[${PRIORITY}+3])
exten => s,n,set(sofie2014test_DATE_DONNEE=${STRFTIME(${EPOCH},,%d%m%Y-%H:%M:%S):6:2}-${ARG2:2:2}-${ARG2:0:2})
exten => s,n,goto(EXEC_PROC)
exten => s,5,gotoif($["${LEN(${ARG2})}" = "6"]?$[${PRIORITY}+1]:ERROR)
exten => s,n,set(sofie2014test_DATE_DONNEE=${ARG2:4:2}-${ARG2:2:2}-${ARG2:0:2})
exten => s,n(EXEC_PROC),Macro(sofie2014sql_exec_proc,${ARG1},\'${sofie2014test_DATE_DONNEE}\',\@_VALIDITY\,\@_DATE_SIZE)
exten => s,108,goto(DATE_ERROR)
exten => s,8,noop(VALIDITY:${@_VALIDITY})
exten => s,n,GotoIf($[${MATH(${@_DATE_SIZE}==4)}=TRUE]?DATE_MIN_FORMAT:$[${PRIORITY}+1])
exten => s,n,GotoIf($[${MATH(${@_DATE_SIZE}==6)}=TRUE]?DATE_MAX_FORMAT:DATE_ERROR)
exten => s,n(DATE_MAX_FORMAT),set(sofie2014DATE_DONNEE=${ARG2:4:2}${ARG2:2:2}${ARG2:0:2})
exten => s,n(DATE_MIN_FORMAT),set(sofie2014DATE_DONNEE=${STRFTIME(${EPOCH},,%d%m%Y-%H:%M:%S):6:2}${ARG2:2:2}${ARG2:0:2})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(DATE_ERROR),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])

[macro-sofie_saisie_date_donnee]
exten => s,1,set(sofie2014DATE_DONNEE=0)
exten => s,2,set(susie2014_local_CPT=0)
exten => s,3(REPRISE_SAISIE_DATE),set(local_CPT=$[${susie2014_local_CPT}+1])
exten => s,4,GotoIf($[${MATH(${susie2014_local_CPT}<=3)}=TRUE]?SAISI_DATE:FIN_TENTATIVE)
exten => s,5(SAISI_DATE),Macro(sofie2014get_data2,sofie2014DATE_DONNEE,${succes_msg_saisie_date_donnee},6,1)
exten => s,106,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,6,gotoif($["${LEN(${VALEUR_SAISIE_1})}" = "0"]?$[${PRIORITY}+1]:ERROR)
exten => s,n,noop(DATE_DONNEE:${sofie2014DATE_DONNEE})
exten => s,n,gotoif($[${REGEX("([0-2][0-9]|30)((0[0-9])|(1[0-2]))([0-9]{2})?" ${sofie2014DATE_DONNEE})}]?$[${PRIORITY}+1]:DATE_ERROR)
exten => s,9,Macro(sofie2014svi_test_date_validity,PROC_VERIF_DATE_VALIDITY,${sofie2014DATE_DONNEE})
exten => s,110,goto(DATE_ERROR)
exten => s,10,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(DATE_ERROR),playback(${succes_audio_file_dir}/${succes_msg_date_donnee_non_valide})
exten => s,n,goto(REPRISE_SAISIE_DATE)
exten => s,n(FIN_TENTATIVE),goto(${succes_audio_file_dir}/finappel,cptfin,1)

[macro-sofie2014gen_code_list];${ARG1}:chaine des numeros des codes incidents saisie,${ARG2}:liste des codes incidents,${ARG3}:nom de la liste des codes incidents saisies retourné,${ARG4}:chaine dont on veut connaitre position dans ${ARG2},${ARG4}:variable contenant la position de ${ARG4}
exten => s,1,set(I=0)
exten => s,n,set(K=1)
exten => s,n,set(sofie2014gen_code_list_L=)
exten => s,n(next_digit),gotoif($[${MATH(${I} < ${LEN(${ARG1})},i)}=TRUE]?loop:end_loop)
exten => s,n(loop),noop([^${ARG1:${K}:$[${LEN(${ARG1})}-${K}]}]:${ARG1:${I}:1})
exten => s,n,gotoif($[${MATH(${K} < ${LEN(${ARG1})},i)}=TRUE]?$[${PRIORITY}+1]:$[${PRIORITY}+2])
exten => s,n,gotoif($[${REGEX("[${ARG1:${K}:$[${LEN(${ARG1})}-${K}]}]" "${ARG1:${I}:1}")}]?ERROR:$[${PRIORITY}+1])
;exten => s,n,gotoif($[${REGEX("[491]" "1")}]?ERROR:$[${PRIORITY}+1])
exten => s,n,set(sofie2014gen_code_list_L${I}=${${ARG2}${ARG1:${I}:1}})
exten => s,n,Set(${sofie2014gen_code_list_L${I}}=1)
exten => s,n,gotoif($["${sofie2014gen_code_list_L${I}}" = "${ARG4}"]?$[${PRIORITY}+1]:$[${PRIORITY}+2])
exten => s,n,Set(${ARG5}=${I})
exten => s,n,Set(I=$[${I}+1])
exten => s,n,Set(K=$[${K}+1])
exten => s,n,goto(next_digit)
exten => s,n(end_loop),Set(${ARG3}=sofie2014gen_code_list_L)
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(ERROR),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])

[macro-sofie2014gen_code_panne_mat];${ARG1}:chaine des numeros des codes incidents saisie,${ARG2}:nom de la chaine contenant le code des incidents materiels retourné
exten => s,1,set(I=0)
exten => s,n,set(K=0)
exten => s,n,set(sofie2014gen_code_panne_mat_L=1)
exten => s,n,set(LEN_MAX=$[${LEN(${ARG1})}+1])
exten => s,n(next1),gotoif($[${MATH(${I} <= 9,i)}=TRUE]?$[${PRIORITY}+1]:end_loop)
exten => s,n,gotoif($[${MATH(${K} < ${LEN(${ARG1})},i)}=TRUE]?$[${PRIORITY}+1]:loop2)
exten => s,n,gotoif($[${MATH(${I}==${ARG1:${K}:1},i)}=TRUE]?$[${PRIORITY}+1]:loop1)
exten => s,n,set(sofie2014gen_code_panne_mat_L=${sofie2014gen_code_panne_mat_L}1)
exten => s,n(reset_k),Set(K=0)
exten => s,n,goto(loop3)
exten => s,n(loop1),Set(K=$[${K}+1])
exten => s,n,goto(next1)
exten => s,n(loop2),set(sofie2014gen_code_panne_mat_L=${sofie2014gen_code_panne_mat_L}0)
exten => s,n,goto(reset_k)
exten => s,n(loop3),Set(I=$[${I}+1])
exten => s,n,goto(next1)
exten => s,n(end_loop),noop(${sofie2014gen_code_panne_mat_L})
exten => s,n,Set(${ARG2}=${sofie2014gen_code_panne_mat_L})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie_is_old_pass]
exten => s,1,gotoif($["${ARG1}" = "0000"]?OK:KO)
exten => s,n(OK),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(KO),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])

[macro-sofie_init_local_CPT]
exten => s,1,set(sofie_local_CPT=0)
exten => s,n,set(sofie_local_CPT1=0)
exten => s,n,set(sofie_local_CPT2=0)
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie_set_local_CPT]
exten => s,1,set(sofie_local_CPT=0)
exten => s,n,set(sofie_local_CPT1=0)
exten => s,n,set(sofie_local_CPT2=0)
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie_coherence_nbv]
exten => s,1,set(TMP_NBV=0)
exten => s,n,set(TMP_NBV=${MATH(${ARG2}+${ARG3},i)})
exten => s,n,GotoIf($[${MATH(${ARG1}==${TMP_NBV})}=TRUE]?EGAL:NON_EGAL)
exten => s,n(EGAL),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(NON_EGAL),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])

[macro-sofie_coherence_sex]
exten => s,1,GotoIf($[${MATH(${ARG1}=="${SOM_SEX}")}=TRUE]?EGAL:NON_EGAL)
exten => s,n(EGAL),noop(${ARG1})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(NON_EGAL),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+501])

[macro-svi_menu_v2]
exten => s,1,set(CPT=0)
exten => s,n,set(svi_menu_localCPT=0)
exten => s,n,gotoif($[${ISNULL(${ARG1})}]?$[${PRIORITY}+2]:$[${PRIORITY}+1])
exten => s,n,playback(${ARG1})
exten => s,n(REPRISE_SAISIE),read(LECTURE|${ARG2}|${ARG4}||1|${ARG6})
exten => s,n,gotoif($["${LEN(${LECTURE})}" = "0"]?AUCUNE_SAISIE:$[${PRIORITY}+1])
exten => s,n,gotoif($["${LECTURE}" = "*"]?SAISIE_ETOILE:$[${PRIORITY}+1])
exten => s,n,set(I=0)
exten => s,n(NEXT),gotoif($[${I} >= ${ARG7}]?ERREUR_SAISIE:$[${PRIORITY}+1])  ;<=====
exten => s,n,set(VAR=$[${I}*4 + 9])
exten => s,n,set(VALEUR=${ARG${VAR}})
exten => s,n,gotoif($["${VALEUR}" = "${LECTURE}"]?GOTO_EXTEN:$[${PRIORITY}+2])
exten => s,n(GOTO_EXTEN),goto(${ARG$[${VAR}+1]},${ARG$[${VAR}+2]},${ARG$[${VAR}+3]})
exten => s,n,set(I=$[${I}+1])
exten => s,n(GOTO_NEXT),goto(NEXT)
exten => s,n(ERREUR_SAISIE),playback(${ARG3})
exten => s,n,set(CPT=$[${CPT} + 1])
exten => s,n,gotoif($["${CPT}" < "${ARG5}"]?$[${PRIORITY}+1]:$[${PRIORITY}+2])
exten => s,n,goto(REPRISE_SAISIE)
exten => s,n(END),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(SAISIE_ETOILE),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+201])
exten => s,n(AUCUNE_SAISIE),goto(s_aucune_saisie-cpt,1)
exten => s_aucune_saisie-cpt,1,gotoif($[${ISNULL(${ARG8})}]?GOTO_END:$[${PRIORITY}+1])
exten => s_aucune_saisie-cpt,n,set(svi_menu_localCPT=$[${svi_menu_localCPT}+1])
exten => s_aucune_saisie-cpt,n,gotoif($["${svi_menu_localCPT}" >= "${ARG5}"]?$[${PRIORITY}+3]:$[${PRIORITY}+1])
exten => s_aucune_saisie-cpt,n,playback(${ARG8})
exten => s_aucune_saisie-cpt,n,goto(s,REPRISE_SAISIE)
exten => s_aucune_saisie-cpt,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101])
exten => s_aucune_saisie-cpt,n(GOTO_END),goto(END)

[macro-sofie2014preproccess_insert_formunlaire];${ARG1}:${NB_LISTE},${ARG3}:recoit la liste des colonnes,${ARG4}:recoit la liste valeurs des colonnes.
exten => s,1,set(${ARG3}=)
exten => s,n,set(${ARG4}=)
exten => s,n,set(VAR_${ARG3}=)
exten => s,n,set(VAR_${ARG4}=)
exten => s,n,gotoif($[${ISNULL(${ARG1})}]?error:$[${PRIORITY}+1])
exten => s,n,gotoif($[${ISNULL(${ARG2})}]?error:$[${PRIORITY}+1])
exten => s,n,set(ID_LISTE=-1)
exten => s,n(NEXT_ELT),set(ID_LISTE=$[${ID_LISTE}+1])
exten => s,n,GotoIf($[${MATH(${ID_LISTE}<=${ARG1})}=TRUE]?loop:done)
exten => s,n(loop),set(${ARG3}=${${ARG3}}${${ARG2}${ID_LISTE}}\,)
exten => s,n,set(${ARG4}=${${ARG4}}${${${ARG2}${ID_LISTE}}}'\,')
exten => s,n,Goto(NEXT_ELT)  ; continue loop if row found
exten => s,n(done),set(${ARG4}_1=)
exten => s,n,set(${ARG3}_1=)
exten => s,n,set(${ARG3}_1=${${ARG3}:0:$[${LEN(${${ARG3}})}-1]})
exten => s,n,set(${ARG4}_1=${${ARG4}:0:$[${LEN(${${ARG4}})}-1]})
exten => s,n,set(VAR_${ARG3}=${${ARG3}_1})
exten => s,n,set(VAR_${ARG4}=${${ARG4}_1})
exten => s,n,noop(VAR_${ARG3}=${VAR_${ARG3}})
exten => s,n,noop(VAR_${ARG4}=${VAR_${ARG4}})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(error),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+701])

[macro-sofie2014preproccess_insert_formunlaire_qualitatif];${ARG1}:${NB_LISTE}
exten => s,1,set(${ARG3}=)
exten => s,n,set(${ARG4}=)
exten => s,n,set(VAR_${ARG3}=)
exten => s,n,set(VAR_${ARG4}=)
exten => s,n,gotoif($[${ISNULL(${ARG1})}]?error:$[${PRIORITY}+1])
exten => s,n,gotoif($[${ISNULL(${ARG2})}]?error:$[${PRIORITY}+1])
exten => s,n,set(ID_LISTE=-1)
exten => s,n(NEXT_ELT),set(ID_LISTE=$[${ID_LISTE}+1])
exten => s,n,GotoIf($[${MATH(${ID_LISTE}<${ARG1})}=TRUE]?loop:done)
exten => s,n(loop),set(${ARG3}=${${ARG3}}${${ARG2}${ID_LISTE}}\,)
exten => s,n,set(${ARG4}=${${ARG4}}${${${ARG2}${ID_LISTE}}}\'\,\')
exten => s,n,Goto(NEXT_ELT)  ; continue loop if row found
exten => s,n(done),set(${ARG4}_1=)
exten => s,n,set(${ARG3}_1=)
exten => s,n,set(${ARG3}_1=${${ARG3}:0:$[${LEN(${${ARG3}})}-1]})
exten => s,n,set(${ARG4}_1=${${ARG4}:0:$[${LEN(${${ARG4}})}-2]})
exten => s,n,set(VAR_${ARG3}=${${ARG3}_1})
exten => s,n,set(VAR_${ARG4}=\'${${ARG4}_1})
exten => s,n,noop(VAR_${ARG3}=${VAR_${ARG3}})
exten => s,n,noop(VAR_${ARG4}=\'${VAR_${ARG4}})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(error),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+701])

[macro-sofie_enreg_formunlaire]
;exten => s,1,Macro(sofie_str_sql_insert,${CODECELI})
;exten => s,1,Macro(sofie2014sql_insert_formunlaire,${ARG1},${ARG2},${ARG3},VAR_${ARG3},VAR_${ARG4},${ARG7})
exten => s,1,Macro(sofie2014sql_insert_formunlaire,${ARG1},${ARG2},${ARG3},VAR_${ARG4},VAR_${ARG5})
exten => s,102,playback(succes2014/msg_erreur_saisie)
exten => s,103,hangup
exten => s,2,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
;exten => s,2,goto(sofie2014finappel,s,1)
;exten => s,2,goto(sofie2014services,s,1)

[macro-sofie_enreg_formunlaire_qualitatif]
;exten => s,1,Macro(sofie_str_sql_insert,${CODECELI})
exten => s,1,Macro(sofie2014sql_insert_formunlaire_qualitatif,${ARG1},${ARG2},VAR_${ARG3},VAR_${ARG4})
exten => s,102,playback(succes2014/msg_erreur_saisie)
exten => s,103,hangup
exten => s,2,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
;exten => s,2,goto(sofie2014finappel,s,1)
;exten => s,2,goto(sofie2014services,s,1)

[macro-sofie_enreg_notification]
exten => s,1,Macro(sofie_sql_insert_notification,${ARG1},${ARG2},${ARG3},${ARG4})
exten => s,102,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+101]);playback(${sofie_audio_file_dir}/${sofie_msg_system_error})
exten => s,103,hangup
exten => s,2,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-sofie_enreg_infos]
exten => s,1,MYSQL(Connect connid ${MYSQLHOST} ${MYSQLUSER} ${MYSQLPASSWORD} ${MYSQLDB})
exten => s,n,set(ID_LISTE=1)
exten => s,n,set(${ARG3}=)
exten => s,n,set(${ARG4}=')
exten => s,n,GotoIf($[${MATH(${ID_LISTE}<=${NB_LISTE})}=TRUE]?$[${PRIORITY}+1]:FIN_STR_LIST)
exten => s,n,set(${ARG3}=${${ARG3}}SUFFRAGE_LISTE${ID_LISTE},)
exten => s,n,set(${ARG4}=${${ARG4}}${SUFFRAGE_LISTE${ID_LISTE}}'\,')
exten => s,n,set(ID_LISTE=$[${ID_LISTE}+1])
exten => s,n,goto(5)
exten => s,n(FIN_STR_LIST),set(${ARG4}_1=)
exten => s,n,set(${ARG3}_1=)
exten => s,n,set(${ARG3}_1=${${ARG3}:0:$[${LEN(${${ARG3}})}-1]})
exten => s,n,set(${ARG4}_1=${${ARG4}:0:$[${LEN(${${ARG4}})}-2]})
exten => s,n,noop(${${ARG3}_1})
exten => s,n,noop(${${ARG4}_1})
exten => s,n,Macro(sofie_enreg_formunlaire,${IDEQUIPEMENT},${NUMBV},${SEX},${NBI},${NBV},${NBN})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
;exten => s,n,playback(succes2014/msg_enreg_infos)
;exten => s,n,goto(sofie2014finappel,s,1)

[macro-sofie2014sendsms]
;exten => s,1,System(lynx -dump "http://192.168.1.149/sms/sendsms.php?SOA=1022&DA=+228${CALLERID(num)}&Content=Ticket:${TICKET_NUMBER}/${TICKET_DESCRIPTION} =>Reparation effectuee avec succes.")
exten => s,1,Macro(sofie2014sql_suiviappel,${UNIQUEID},7,${CALLERID(Num)},1,0)
exten => s,2,System(lynx -dump "http://192.168.1.149/sms/sendsms.php?SOA=1022&DA=+225${CALLERID(num)}&Content=${ARG1}")
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

;;SAYNUMBER permet de lire un nombre compris entre 0 et 999999
;${ARG1} le nombre à lire
[macro-saynumber]
exten => s,1,gotoif($[${ARG1} >= 0]?:$[${PRIORITY}+16])
exten => s,n,gotoif($[${ARG1} <= 99]?:$[${PRIORITY}+3])
exten => s,3,Macro(dizaine,${ARG1},${ARG2})
exten => s,n,goto(16)
exten => s,5,gotoif($[${ARG1} >= 100]?:$[${PRIORITY}+4])
exten => s,n,gotoif($[${ARG1} <= 999]?:$[${PRIORITY}+3])
exten => s,7,Macro(centaine,${ARG1},${ARG2})
exten => s,n,goto(16)
exten => s,n,gotoif($[${ARG1} >= 1000]?:$[${PRIORITY}+4])
exten => s,10,gotoif($[${ARG1} <= 999999]?:$[${PRIORITY}+3])
exten => s,11,Macro(mille,${ARG1},${ARG2})
exten => s,n,goto(16)
exten => s,n,gotoif($[${ARG1} >= 1000000]?:$[${PRIORITY}+4])
exten => s,n,gotoif($[${ARG1} <= 999999999]?:$[${PRIORITY}+3])
exten => s,15,Macro(million,${ARG1},${ARG2})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])

[macro-dizaine]
exten => s,1,Macro(suprimedebutzero,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-2]]:${LEN(${ARG1})-2}})
exten => s,n,playback(numbers/${ARG2}/${NBRE})

[macro-centaine]
exten => s,1,gotoif($[${ARG1} >= 1]?sup1:goto_exit)
exten => s,n(sup1),gotoif($[${ARG1} <= 99]?inf99:sup99)
exten => s,3(inf99),Macro(dizaine,${ARG1},${ARG2})
exten => s,n,goto(17)
exten => s,5(sup99),gotoif($[${ARG1} >= 100]?sup100:goto_exit)
exten => s,n(sup100),gotoif($[${ARG1} = 100]?egal_cent:diff_cent)
exten => s,n(egal_cent),playback(numbers/${ARG2}/cent)
exten => s,n,goto(17)
exten => s,n(diff_cent),gotoif($[${ARG1} <= 999]?inf999:sup999)
exten => s,10(inf999),gotoif($[${ARG1:0:$[${LEN(${ARG1})}-2]} = '1']?egal1:diff1)
exten => s,n(egal1),playback(numbers/${ARG2}/cent)
exten => s,12,Macro(dizaine,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-2]]:${LEN(${ARG1})-2}},${ARG2})
exten => s,n(sup999),goto(17)
exten => s,n(diff1),playback(numbers/${ARG2}/${ARG1:0:$[${LEN(${ARG1})}-2]})
exten => s,15(diff1),playback(numbers/${ARG2}/cent)
exten => s,n,gotoif($[${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-2]]:${LEN(${ARG1})-2}} = '00']?goto_exit:goto_suprimedebutzero)
exten => s,n(goto_exit),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,n(goto_suprimedebutzero),Macro(suprimedebutzero,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-2]]:${LEN(${ARG1})-2}})
exten => s,n,Macro(dizaine,${NBRE},${ARG2})

[macro-mille]
exten => s,1,gotoif($[${ARG1} >= 100]?sup1:goto_exit)
exten => s,n(sup1),gotoif($[${ARG1} <= 999]?inf999:sup999)
exten => s,3(inf999),Macro(centaine,${ARG1},${ARG2})
exten => s,n,goto(17)
exten => s,5(sup999),gotoif($[${ARG1} >= 1000]?sup1000:goto_exit)
exten => s,n(sup1000),gotoif($[${ARG1} = 1000]?egal_mille:diff_mille)
exten => s,n(egal_mille),playback(numbers/${ARG1}/mille)
exten => s,n,goto(17)
exten => s,n(diff_mille),gotoif($[${ARG1} <= 999999]?inf999999:sup999999)
exten => s,10(inf999999),gotoif($[${ARG1:0:$[${LEN(${ARG1})}-3]} = 1]?egal1:diff1)
exten => s,n(egal1),playback(numbers/${ARG2}/mille)
exten => s,12,Macro(centaine,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-3]]:${LEN(${ARG1})-3}},${ARG2})
exten => s,n(sup999999),goto(17)
exten => s,n(diff1),Macro(centaine,${ARG1:0:$[${LEN(${ARG1})}-3]},${ARG2})
exten => s,15,playback(numbers/${ARG2}/mille)
exten => s,n,gotoif($[${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-3]]:${LEN(${ARG1})-3}} = '000']?:$[${PRIORITY}+2])
exten => s,n(goto_exit),goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,18,Macro(suprimedebutzero,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-3]]:${LEN(${ARG1})-3}})
exten => s,n,Macro(centaine,${NBRE},${ARG2})

[macro-million]
exten => s,1,gotoif($[${ARG1} >= 1000]?:14)
exten => s,n,gotoif($[${ARG1} <= 999999]?:$[${PRIORITY}+3])
exten => s,n,Macro(mille,${ARG1},${ARG2})
exten => s,n,goto(14)
exten => s,5,gotoif($[${ARG1} >= 1000000]?:14)
exten => s,n,gotoif($[${ARG1} = 1000000]?:$[${PRIORITY}+4])
exten => s,n,playback(numbers/${ARG2}/1)
exten => s,n,playback(numbers/${ARG2}/million)
exten => s,n,goto(14)
exten => s,10,gotoif($[${ARG1} <= 999999999]?:$[${PRIORITY}+4])
exten => s,n,Macro(centaine,${ARG1:-${LEN(${ARG1})}:$[${LEN(${ARG1})}-6]},${ARG2})
exten => s,n,playback(numbers/${ARG2}/million)
exten => s,n,gotoif($[${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-6]]:${LEN(${ARG1})-6}} = '000000']?:$[${PRIORITY}+2])
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
exten => s,15,Macro(suprimedebutzero,${ARG1:-$[${LEN(${ARG1})}-$[${LEN(${ARG1})}-6]]:${LEN(${ARG1})-3}})
exten => s,n,Macro(mille,${NBRE})

[macro-suprimedebutzero]
exten => s,1,set(I=0)
exten => s,n,gotoif($[$[${LEN(${ARG1})}-1] = ${I}]?$[${PRIORITY}+5])
exten => s,n,noop(${ARG1:${I}:1})
exten => s,n,gotoif($[${ARG1:${I}:1} = 0]?:$[${PRIORITY}+3])
exten => s,n,set(I=$[${I}+1])
exten => s,n,goto(2)
exten => s,n,set(NBRE=${ARG1:${I}:${LEN(${ARG1})-${I}}})
exten => s,n,noop(${NBRE})
exten => s,n,goto(${MACRO_CONTEXT},${MACRO_EXTEN},$[${MACRO_PRIORITY}+1])
